package com.lmh.android.mobilenumberquery;

import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;

import org.xmlpull.v1.XmlPullParser;
import org.xmlpull.v1.XmlPullParserFactory;

public class MobileService {

	/**
	 * query telephone numbers' belonging to
	 * @param tel the target telephone number
	 * @return the belonging-to of the target telephone number 
	 * @throws Exception 
	 * @throws MalformedURLException 
	 */
	public String getMobileBelongingTo(String tel) throws MalformedURLException, Exception {
		String urlPath = "http://webservice.webxml.com.cn/WebServices/MobileCodeWS.asmx";
		InputStream soapXml = this.getClass().getClassLoader().getResourceAsStream("soap12.xml");
		String soap = new String(ReadService.readFromStream(soapXml), "UTF-8");
		soap = soap.replace("\\$mobile", tel);
		byte[] soapBytes = soap.getBytes();
		HttpURLConnection conn = (HttpURLConnection) new URL(urlPath).openConnection();
		conn.setRequestMethod("POST");
		conn.setReadTimeout(3000);
		conn.setDoOutput(true);
		conn.setRequestProperty("Content-Type", "application/soap+xml; charset=utf-8");
		conn.setRequestProperty("Content-Length", String.valueOf(soapBytes.length));
		OutputStream out = conn.getOutputStream();
		out.write(soapBytes);
		out.flush();
		if(conn.getResponseCode() == HttpURLConnection.HTTP_OK) {
			return parseXML(conn.getInputStream());
		}
		return null;
	}

	private String parseXML(InputStream inputStream) {
		XmlPullParser parser = XmlPullParserFactory.newInstance().newPullParser();
		return null;
	}
	
}
